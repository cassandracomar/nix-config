(defwindow primary [monitor]
           :monitor monitor
           :geometry (geometry :x 0 :y 0 :height "32px" :width "100%" :anchor "center top")
           :stacking "fg"
           :exclusive true
           :focusable false
  (bar0 :monitor monitor))

; â”â”â”â” bars â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•¸

(defwidget bar0 [monitor]
  (centerbox :orientation "h"
    (box :class "right"
         :halign "start"
         :spacing 20
      (workspaces :monitor monitor))
    (box :class "right"
         :halign "center"
         :spacing 20
         :space-evenly true
      (tab-bar :monitor monitor))
    (box :class "right"
         :halign "end"
         :spacing 10
         :space-evenly false
      (tray)
      (battery)
      (mic)
      (speakers)
      (date)
      (time)
      (power :monitor monitor)
      (label :text ""))))

; â”â”â”â” workspaces â•ºâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•¸

(deflisten workspaces_listen :initial '{"HDMI-A-1": "", "eDP-1": ""}' "pinnacle client <./modules/pinnacle-workspaces.lua")

(defwidget workspaces [monitor]
  (literal :content "${workspaces_listen[monitor]}"))

; â”â”â”â” tab-bar â•ºâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•¸
(deflisten tab_bar_listen :initial '{"HDMI-A-1": "", "eDP-1": ""}' "pinnacle client <./modules/pinnacle-tab-bar.lua")
(defwidget tab-bar [monitor]
  (literal :content "${tab_bar_listen[monitor]}"))

; â”â”â”â” battery â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•¸
(defwidget battery []
  (overlay :visible {EWW_BATTERY != ''}
    (box :class "battery"
      :space-evenly false
      (label :class "icon ${  EWW_BATTERY == ''? ''
                            : EWW_BATTERY["BAT0"].capacity <= 20 ? 'critical'
                            : EWW_BATTERY["BAT0"].capacity <= 40 ? 'low'
                            : 'normal' }"
             :text "${  EWW_BATTERY == '' ? ''
                      : EWW_BATTERY["BAT0"].capacity > 95 ? 'ó°¹'
                      : EWW_BATTERY["BAT0"].capacity > 90 ? 'ó°‚‚'
                      : EWW_BATTERY["BAT0"].capacity > 80 ? 'ó°‚'
                      : EWW_BATTERY["BAT0"].capacity > 70 ? 'ó°‚€'
                      : EWW_BATTERY["BAT0"].capacity > 60 ? 'ó°¿'
                      : EWW_BATTERY["BAT0"].capacity > 50 ? 'ó°¾'
                      : EWW_BATTERY["BAT0"].capacity > 40 ? 'ó°½'
                      : EWW_BATTERY["BAT0"].capacity > 30 ? 'ó°¼'
                      : EWW_BATTERY["BAT0"].capacity > 20 ? 'ó°»'
                      : EWW_BATTERY["BAT0"].capacity > 10 ? 'ó°º'
                      : 'ó°‚ƒ' }"
              :tooltip "battery: ${EWW_BATTERY?.["BAT0"]?.capacity ?: "none"}%"))
    (label :class "bat-charging-symbol"
           :text "âš¡"
           :visible {EWW_BATTERY["BAT0"].status == 'Charging' || EWW_BATTERY["BAT0"].status == 'Full'})))

; â”â”â”â” tray â•ºâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•¸

(defwidget tray []
  (box :class "tray"
    (systray :spacing 10 :space-evenly true :icon-size 16)))

; â”â”â”â” mic â•ºâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•¸

(deflisten mic :initial 0  "./modules/listen-mic.sh")

(defwidget mic []
  (box :class "mic"
    :space-evenly false
    (button :class "mute-toggle"
            :onclick "pactl set-source-mute @DEFAULT_SOURCE@ toggle"
      ; 0: muted, 1: unmuted, 2: running
      (label :class "icon single-icon ${mic == 2 ? 'running' : mic == 0 ? 'muted' : ''}"
             :text "${mic == 0 ? 'ó°­' :  'ó°¬' }"))))

; â”â”â”â” volume â•ºâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•¸

(deflisten speakers :initial '{ "volume": 0, "muted": "false" }' "./modules/listen-volume.sh")

(defwidget speakers []
  (tooltip
    (label :class "tooltip" :text "${ speakers.volume }%")
    (box :class "speakers"
      :space-evenly false
      (button :class "icon ${ speakers.volume > 100 ? 'over' : '' } ${ speakers.muted ? 'muted' : '' }"
        :onclick "pactl set-sink-mute @DEFAULT_SINK@ toggle"
        (label :text "${ speakers.muted ? 'ó°–' :
                        speakers.volume > 70 ? 'ó°•¾' :
                        speakers.volume > 35 ? 'ó°–€' :
                        'ó°•¿' }"))

    (scale
      :class "${ speakers.volume > 100 ? 'over' : '' }"
      :min 0
      :max 100
      :value "${speakers.volume}"
      :onchange "pactl set-sink-volume @DEFAULT_SINK@ {}%"))))

; â”â”â”â” date â•ºâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•¸

(defpoll date_poll :interval "1m" "date +%Y-%m-%d")

(defwidget date []
  (box :space-evenly false
    (label :class "date" :text date_poll)))

; â”â”â”â” time â•ºâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•¸

(defpoll time_poll :interval "1s" "date +%H:%M")

(defwidget time []
  (box :class "time"
       :space-evenly false
    (label :text time_poll)))

; â”â”â”â” powermenu â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•¸
(defwindow power []
           :stacking "fg"
  (powermenu_layout))

(defwidget powermenu [shutdown shutdown_icon reboot reboot_icon logout 
                       logout_icon lock lock_icon sleep sleep_icon cancel_icon]
  (box :vexpand true 
       :hexpand true
       :space-evenly false 
       :class "power-box" 
       :valign "end"
       :halign "end"
       :spacing 5
       :orientation "v"
    (button :class "power-shutdown-button" :onclick "${shutdown} && ${EWW_CMD} close power" shutdown_icon)
    (button :class "power-reboot-button" :onclick "${reboot} && ${EWW_CMD} close power" reboot_icon)
    (button :class "power-logout-button" :onclick "${logout} && ${EWW_CMD} close power" logout_icon)
    (button :class "power-lock-button" :onclick "${lock} && ${EWW_CMD} close power" lock_icon)
    (button :class "power-sleep-button" :onclick "${sleep} && ${EWW_CMD} close power" sleep_icon)
    (button :class "power-close-button" :onclick "${EWW_CMD} close power" cancel_icon)))

(defwidget powermenu_layout []
  (box :class "power-layout-box" :space-evenly false
    (box :space-evenly false :hexpand true :vexpand true
      (powermenu :shutdown "shutdown -h now"
                 :shutdown_icon "â»"
                 :reboot "sudo -A reboot"
                 :reboot_icon "â†»"
                 :logout "loginctl kill-session self"
                 :logout_icon "â†ª"
                 :lock "loginctl lock-session self"
                 :lock_icon "ğŸ”’ï¸"
                 :sleep "sudo -A systemctl suspend"
                 :sleep_icon "â¾"
                 :cancel_icon "âœ˜"))))

(defwidget power [monitor]
  (button :class "power"
          :onclick "${EWW_CMD} open power --screen ${monitor}"
    "â»"))
