#!/usr/bin/env zsh

before=$(realpath "$(which emacs)")
echo "invoking nixos-rebuild"

sudo nix flake update /etc/nixos
sudo /run/current-system/sw/bin/nixos-rebuild $*

if [ "$(realpath $(which emacs))" != "$before" ]; then
    echo "emacs changed. invoking native compilation rebuild."
    ~/.emacs.d/bin/doom build
fi
